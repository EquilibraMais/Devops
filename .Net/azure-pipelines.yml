trigger:
  - main

pool:
  vmImage: "windows-latest"

variables:
  buildConfiguration: "Release"

steps:
  - task: UseDotNet@2
    inputs:
      packageType: "sdk"
      version: "8.x"
      installationPath: $(Agent.ToolsDirectory)/dotnet

  - script: dotnet restore
    displayName: "Dotnet Restore"

  - script: dotnet build --configuration $(buildConfiguration)
    displayName: "Dotnet Build"

  - script: dotnet test --configuration $(buildConfiguration)
    displayName: "Dotnet Test"

  - script: dotnet publish --configuration $(buildConfiguration) --output $(Build.ArtifactStagingDirectory)
    displayName: "Dotnet Publish"

  - task: PublishBuildArtifacts@1
    inputs:
      pathToPublish: "$(Build.ArtifactStagingDirectory)"
      artifactName: "drop"
      publishLocation: "Container"

  - task: AzureWebApp@1
    inputs:
      azureSubscription: "EquilibraMais"
      appType: "webApp"
      appName: "equilibramais"
      package: "$(Build.ArtifactStagingDirectory)/**.zip"
